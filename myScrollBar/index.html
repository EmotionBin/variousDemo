<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>elScrollBar</title>
  <script src="./vendor/vue/vue.js"></script>
  <!-- <script src="./vendor/element/index.js"></script> -->
  <!-- <link rel="stylesheet" href="./vendor/element/index.css"> -->
  <style>
    *{
      margin: 0;
    }
    .head{
      text-align: center;
    }
    .elScrollBar{
      height: 40vh;
    }
    .el-scrollbar__wrap {
      overflow-x: hidden;
    }
    .div-wrap{
      height: 500px;width: 100%;
    }
    .div1{
      background: red;
    }
    .div2{
      background: yellowgreen;
    }
    .div3{
      background: blueviolet;
    }
    .my-scrollbar{
      height: 40vh;
      position: relative;
      overflow: hidden;
    }
    .my-scrollbar-wrap{
      height: 100%;
      /* è¿™é‡Œè´Ÿçš„å³å¤–è¾¹è·æ˜¯ä¸ºäº†æŠŠwindowsè‡ªå¸¦çš„æ»šåŠ¨æ¡éšè— */
      margin-right: -15px;
      overflow: auto;
    }
    .my-scrollbar-scroll{
      position: absolute;
      top: 2px;
      right: 2px;
      bottom: 2px;
      width: 6px;
      z-index: 1;
      border-radius: 4px;
      /* opacity: 0; */
      -webkit-transition: opacity 120ms ease-out;
      transition: opacity 120ms ease-out;
    }
    .my-scrollbar-scroll-thumb{
      position: relative;
      display: block;
      width: 100%;
      /* æ»šåŠ¨æ¡æ»‘å—çš„é«˜åº¦å¿…é¡»æ˜¯è®¡ç®—å‡ºæ¥çš„ */
      height: 0;
      cursor: pointer;
      border-radius: inherit;
      background-color: rgba(0,0,0,.3);
      -webkit-transition: .3s background-color;
      transition: .3s background-color;
    }
    .hide{
      display: none;
    }
  </style>
</head>
<body>
  <div class="head hide">
    <h1>elementéšè—æ»šåŠ¨æ¡ç»„ä»¶ğŸ˜</h1>
  </div>
  <div class="elScrollBar hide">
    <!-- æ³¨æ„éœ€è¦ç»™ el-scrollbar è®¾ç½®é«˜åº¦ï¼Œåˆ¤æ–­æ˜¯å¦æ»šåŠ¨æ˜¯çœ‹å®ƒçš„heightåˆ¤æ–­çš„ -->
    <el-scrollbar style="height: 100%;"> <!-- æ»šåŠ¨æ¡ -->
      <div class="div-wrap div1"></div>
      <div class="div-wrap div2"></div>
      <div class="div-wrap div3"></div>
  </el-scrollbar><!-- /æ»šåŠ¨æ¡ -->
  </div>
  <div class="head">
    <h1>æˆ‘è‡ªå·±å†™çš„æ»šåŠ¨æ¡æ’ä»¶ğŸ˜</h1>
  </div>
  <div class="my-scrollbar">
    <div class="my-scrollbar-wrap" ref="myScrollbar">
      <div class="my-scrollbar-view">
        <div class="div-wrap div1"></div>
        <div class="div-wrap div2"></div>
        <div class="div-wrap div3"></div>
      </div>
    </div>
    <div class="my-scrollbar-scroll vertical" ref="myScrollbarVertical" @mousedown="verticalMouseDown">
      <div class="my-scrollbar-scroll-thumb" ref="scrollbarThumb" @mousedown="mouseDown"></div>
    </div>
  </div>
</body>
<script type="text/javascript">
  // var elScrollBar_el = new Vue({
  //   el:'.elScrollBar',
  //   data:{

  //   },
  //   mounted(){

  //   },
  //   computed:{

  //   },
  //   methods:{
        
  //   }
  // });

  //è¿™æ˜¯æˆ‘è‡ªå·±å†™çš„æ»šåŠ¨æ¡ç»„ä»¶
  var myScrollBar_el = new Vue({
    el:'.my-scrollbar',
    data:{
      //é¼ æ ‡æ˜¯å¦æŒ‰ä¸‹
      cursorDown:false,
    },
    mounted(){
      //åœ¨åˆå§‹åŒ–çš„æ—¶å€™ç›‘å¬é¼ æ ‡æ»šè½®æ»šåŠ¨äº‹ä»¶
			this.$refs.myScrollbar.addEventListener('scroll', this.handleScroll);
      //åˆå§‹åŒ– è®¡ç®—æ»šåŠ¨æ¡é«˜åº¦
      this.init();
    },
    destroyed () {
			//åœ¨ç»„ä»¶é”€æ¯çš„æ—¶å€™å–æ¶ˆå„ç§äº‹ä»¶çš„ç›‘å¬
      this.$refs.myScrollbar.removeEventListener('scroll', this.handleScroll);
      document.removeEventListener('mouseup', this.mouseUp);
		},
    computed:{

    },
    methods:{
      //åˆå§‹åŒ– è®¡ç®—æ»šåŠ¨æ¡çš„é«˜åº¦
      init(){
        let heightPercentage;
        const scrollWrap = this.$refs.myScrollbar;
        if (!scrollWrap) return;
        //æ ¹æ®å¯è§†åŒºåŸŸçš„é«˜åº¦ä¸è¿™ä¸ªdivçš„æ‰€æœ‰é«˜åº¦çš„æ¯”å€¼è®¡ç®—å‡ºæ»šåŠ¨æ¡æ»‘å—çš„é«˜åº¦
        heightPercentage = (scrollWrap.clientHeight * 100 / scrollWrap.scrollHeight);
        //å¦‚æœé«˜åº¦è¶…è¿‡100 è¯´æ˜æ²¡æœ‰å‘ç”Ÿæº¢å‡º ä¸ä¼šå‡ºç°æ»šåŠ¨æ¡
        if(heightPercentage >= 100) return;
        this.$refs.scrollbarThumb.style.height = heightPercentage + '%';
      },
      //é¼ æ ‡åœ¨æ»šåŠ¨æ¡ä¸Šæ»šåŠ¨çš„æ—¶å€™è§¦å‘
      handleScroll(){
        const scrollWrap = this.$refs.myScrollbar;
        const scroll = this.$refs.scrollbarThumb;
        //å½“å‰æ»šåŠ¨é«˜åº¦ä¸å¯è§†åŒºåŸŸçš„é«˜åº¦çš„æ¯”å€¼å°±æ˜¯æ»šåŠ¨æ¡æ»‘å—ç§»åŠ¨çš„è·ç¦»
        scroll.style.transform = `translateY(${scrollWrap.scrollTop * 100 / scrollWrap.clientHeight}%)`;
      },
      //é¼ æ ‡åœ¨æ»šåŠ¨æ¡æ»‘å—ä¸ŠæŒ‰ä¸‹çš„å›è°ƒ
      mouseDown(e){
        //æŒ‰ä¸‹é¼ æ ‡å³é”®ä¸è§¦å‘
        if (e.ctrlKey || e.button === 2) {
          return;
        }
        this.startDrag(e);
        //è®¡ç®—é¼ æ ‡åœ¨æ»‘å—ä¸Šç‚¹å‡»çš„ä½ç½®è·ç¦»æ»šåŠ¨æ¡æ»‘å—åº•éƒ¨çš„è·ç¦»ï¼Œå¹¶å°†è¿™ä¸ªå€¼æŒ‚è½½ådataå±æ€§ä¸­ï¼Œæ–¹ä¾¿åé¢åšåˆ¤æ–­
        this.thumbBottom = e.currentTarget.offsetHeight - (e.clientY - e.currentTarget.getBoundingClientRect().top);
      },
      startDrag(e){
        //å¦‚æœæœ‰å¤šä¸ªç›¸åŒç±»å‹äº‹ä»¶çš„äº‹ä»¶ç›‘å¬å‡½æ•°ç»‘å®šåˆ°åŒä¸€ä¸ªå…ƒç´ ï¼Œå½“è¯¥ç±»å‹çš„äº‹ä»¶è§¦å‘æ—¶ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§è¢«æ·»åŠ çš„é¡ºåºæ‰§è¡Œ(è¯¦è§MDN)
        //é˜»æ­¢mousedownäº‹ä»¶å†’æ³¡,å¹¶ä¸”é˜»æ­¢på…ƒç´ ä¸Šç»‘å®šçš„å…¶ä»–mousedownäº‹ä»¶çš„äº‹ä»¶ç›‘å¬å‡½æ•°çš„æ‰§è¡Œ
        e.stopImmediatePropagation();
        this.cursorDown = true;
        document.addEventListener('mousemove', this.mouseMove);
        document.addEventListener('mouseup', this.mouseUp);
        // åœ¨ç½‘é¡µä¸­æ‹–åŠ¨æ—¶ï¼Œä¼šå¼•èµ·æŸäº›æ–‡å­—æˆ–ä¸€äº›å†…å®¹è¢«é€‰ä¸­ï¼Œå¯¼è‡´ç½‘é¡µä¸­è“è“çš„ä¸€ç‰‡ï¼Œè§†è§‰æ•ˆæœå¾ˆå·®ï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®onselectstartä¸ºfalse
        document.onselectstart = () => false;
      },
      //é¼ æ ‡ç§»åŠ¨çš„å›è°ƒ
      mouseMove(e){
        /* 
          æ€è·¯:
          è®¡ç®—å‡ºé¼ æ ‡æ­¤æ—¶ä½ç½®ä¸æ»šåŠ¨æ¡é¡¶éƒ¨çš„è·ç¦»offset
          è®¡ç®—å‡ºå½“å‰é¼ æ ‡ä½ç½®ä¸æ»šåŠ¨æ¡æ»‘å—åº•éƒ¨è·ç¦»thumbClickPosition
          è®¡ç®—å‡ºæ»šåŠ¨æ¡æ»‘å—é¡¶éƒ¨è·ç¦»æ»šåŠ¨æ¡é¡¶éƒ¨è·ç¦»çš„ç™¾åˆ†æ¯”å€¼thumbPositionPercentage
          è®¡ç®—å‡ºæ•´ä¸ªæ»šåŠ¨æ¡çš„scrollTopï¼Œå³æŠŠå¯è§†åŒºåŸŸçš„ç™¾åˆ†æ¯”thumbPositionPercentageæ˜ å°„åˆ°æ•´ä¸ªdivé«˜åº¦
          æ‰‹åŠ¨æ”¹å˜scrollTop
          æ‰‹åŠ¨æ”¹å˜æ»‘å—ä½ç½®
        */
        if(!this.cursorDown) return ;
        const prevPage = this.thumbBottom;
        if(!prevPage) return;
        const scrollWrap = this.$refs.myScrollbar;
        const scroll = this.$refs.scrollbarThumb;
        const vertical = this.$refs.myScrollbarVertical;
        // è®¡ç®—å‡ºé¼ æ ‡æ­¤æ—¶ä½ç½®ä¸æ»šåŠ¨æ¡é¡¶éƒ¨çš„è·ç¦»offset
        const offset = e.clientY - vertical.getBoundingClientRect().top;
        // é˜²æ­¢æ»šåŠ¨æ¡æ»‘å—è¶…å‡ºæ»šåŠ¨æ¡çš„é¡¶éƒ¨æˆ–åº•éƒ¨æœ€å¤§å®‰å…¨è·ç¦»
        if(offset + prevPage - scroll.clientHeight < 0 || offset + prevPage > scrollWrap.clientHeight) return;
        // è®¡ç®—å‡ºå½“å‰é¼ æ ‡ä½ç½®ä¸æ»šåŠ¨æ¡æ»‘å—é¡¶éƒ¨éƒ¨è·ç¦»(æ»šåŠ¨æ¡æ»‘å—é«˜åº¦ - é¼ æ ‡åœ¨æ»‘å—ä¸Šç‚¹å‡»çš„ä½ç½®è·ç¦»æ»šåŠ¨æ¡thumbåº•éƒ¨çš„è·ç¦»)
        const thumbClickPosition = scroll.offsetHeight - prevPage;
        // è®¡ç®—å‡ºæ»šåŠ¨æ¡æ»‘å—é¡¶éƒ¨è·ç¦»æ»šåŠ¨æ¡é¡¶éƒ¨è·ç¦»çš„ç™¾åˆ†æ¯”å€¼
        const thumbPositionPercentage = ((offset - thumbClickPosition) * 100 / vertical.offsetHeight);
        // ä¸Šé¢è®¡ç®—çš„ç™¾åˆ†æ¯”å€¼ä¹˜ä¸Šæ•´ä¸ªè¿™ä¸ªdivçš„æ‰€æœ‰é«˜åº¦å†é™¤ä»¥100å¾—åˆ°çœŸæ­£çš„scrollTop
        const scrollTop = thumbPositionPercentage * scrollWrap.scrollHeight / 100;
        // æ”¹å˜scrollTopï¼Œå› ä¸ºæ²¡æœ‰è§¦å‘æ»šåŠ¨äº‹ä»¶ï¼Œåªæœ‰æ‰‹åŠ¨æ”¹å˜scrollTopï¼Œå¯è§†åŒºåŸŸæ‰ä¼šå‘ç”Ÿæ»šåŠ¨
        scrollWrap.scrollTop = scrollTop;
        // åœ¨å¯è§†åŒºåŸŸå‘ç”Ÿæ»šåŠ¨çš„åŒæ—¶ï¼Œæ»‘å—ä¹Ÿè¦åŒæ­¥æ»šåŠ¨
        scroll.style.transform = `translateY(${scrollTop * 100 / scrollWrap.clientHeight}%)`;
      },
      //é¼ æ ‡æŒ‰ä¸‹åæŠ¬èµ·çš„å›è°ƒ
      mouseUp(e){
        this.cursorDown = false;
        this.thumbBottom = 0;
        document.removeEventListener('mousemove', this.mouseMove);
        document.onselectstart = () => null;
      },
      //ç‚¹å‡»æ»šåŠ¨æ¡å¯æ»šåŠ¨åŒºåŸŸ é‡æ–°å®šä½æ»šåŠ¨æ¡
      verticalMouseDown(e){
        /*
          æ€è·¯:
          è®¡ç®—å‡ºå½“å‰é¼ æ ‡ä½ç½®ä¸æ»šåŠ¨æ¡é¡¶éƒ¨çš„è·ç¦»offset
          è®¡ç®—å‡ºæ»šåŠ¨æ¡æ»‘å—çš„é«˜åº¦çš„ä¸€åŠthumbHalf
          ï¼ˆoffset-thumbHalfï¼‰é™¤ä»¥æ»šåŠ¨æ¡é«˜åº¦å³æ»šåŠ¨æ¡æ»‘å—è·ç¦»æ»šåŠ¨æ¡é¡¶éƒ¨çš„ç™¾åˆ†æ¯”å€¼
          è®¡ç®—å‡ºæ•´ä¸ªæ»šåŠ¨æ¡çš„scrollTop
          æ‰‹åŠ¨æ”¹å˜scrollTop
          æ‰‹åŠ¨æ”¹å˜æ»‘å—ä½ç½®
        */
        const scrollWrap = this.$refs.myScrollbar;
        const offset = Math.abs(e.target.getBoundingClientRect().top - e.clientY);
        const thumbHalf = (this.$refs.scrollbarThumb.offsetHeight / 2);
        const thumbPositionPercentage = ((offset - thumbHalf) * 100 / this.$refs.myScrollbarVertical.offsetHeight);
        const scrollTop = thumbPositionPercentage * scrollWrap.scrollHeight / 100;
        scrollWrap.scrollTop = scrollTop;
        this.$refs.scrollbarThumb.style.transform = `translateY(${scrollTop * 100 / scrollWrap.clientHeight}%)`;
      }
    }
  });
</script>
</html>